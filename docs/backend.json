{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile information.",
      "properties": {
        "uid": { "type": "string", "description": "The user's unique ID." },
        "displayName": { "type": "string", "description": "The user's display name." },
        "email": { "type": "string", "format": "email", "description": "The user's email address." },
        "avatarUrl": { "type": "string", "format": "uri", "description": "URL of the user's avatar image." },
        "online": { "type": "boolean", "description": "Indicates if the user is currently online." },
        "theme": {
          "type": "string",
          "enum": ["light", "dark", "system"],
          "description": "The user's preferred theme."
        }
      },
      "required": ["uid", "email"]
    },
    "ArtisanProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ArtisanProfile",
      "type": "object",
      "description": "Represents the profile of an artisan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ArtisanProfile entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the artisan."
        },
        "craft": {
          "type": "string",
          "description": "The artisan's craft or specialty."
        },
        "location": {
          "type": "string",
          "description": "The location of the artisan."
        },
        "story": {
          "type": "string",
          "description": "The artisan's personal story."
        }
      },
      "required": [
        "id",
        "name",
        "craft",
        "location",
        "story"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product offered by an artisan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product entity."
        },
        "artisanId": {
          "type": "string",
          "description": "Reference to ArtisanProfile. (Relationship: ArtisanProfile 1:N Product)"
        },
        "name": {
          "type": "string",
          "description": "The name of the product."
        },
        "description": {
          "type": "string",
          "description": "A description of the product."
        },
        "price": {
          "type": "number",
          "description": "The price of the product."
        },
        "photoUrls": {
          "type": "array",
          "description": "URLs of photos of the product.",
          "items": {
            "type": "string"
          }
        },
        "tagIds": {
          "type": "array",
          "description": "References to Tags. (Relationship: Tag N:N Product)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "artisanId",
        "name",
"description",
        "price",
        "photoUrls"
      ]
    },
    "Tag": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tag",
      "type": "object",
      "description": "Represents a tag for categorizing products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Tag entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the tag."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "StoryCard": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StoryCard",
      "type": "object",
      "description": "Represents a story card generated for a product.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StoryCard entity."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:1 StoryCard)"
        },
        "artisanId": {
          "type": "string",
          "description": "Reference to ArtisanProfile."
        },
        "description": {
          "type": "string",
          "description": "Description generated for the product."
        },
        "audioUrl": {
          "type": "string",
          "description": "URL for the audio story."
        }
      },
      "required": [
        "id",
        "productId",
        "artisanId",
        "description",
        "audioUrl"
      ]
    },
    "ContactMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ContactMessage",
      "type": "object",
      "description": "Represents a contact message submitted by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ContactMessage entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the user submitting the message."
        },
        "email": {
          "type": "string",
          "description": "Email of the user submitting the message.",
          "format": "email"
        },
        "message": {
          "type": "string",
          "description": "The message or issue description."
        },
        "timestamp": {
          "type": "string",
"description": "Timestamp of when the message was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "message",
        "timestamp"
      ]
    },
    "CustomerReview": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CustomerReview",
      "type": "object",
      "description": "Represents a customer review for a product or artisan.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CustomerReview entity."
        },
        "artisanId": {
          "type": "string",
          "description": "Reference to ArtisanProfile. (Relationship: ArtisanProfile 1:N CustomerReview).  If null, then references a Product."
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N CustomerReview).  If null, then references an Artisan."
        },
        "customerName": {
          "type": "string",
          "description": "Name of the customer providing the review."
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the customer (e.g., 1-5 stars)."
        },
        "reviewText": {
          "type": "string",
          "description": "Text of the customer's review."
        },
        "reviewDate": {
          "type": "string",
          "description": "Date when the review was submitted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "customerName",
        "rating",
        "reviewText",
        "reviewDate"
      ]
    },
    "CartItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CartItem",
      "type": "object",
      "description": "Represents an item in a user's shopping cart.",
      "properties": {
        "productId": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "price": {
          "type": "number"
        },
        "imageUrl": {
          "type": "string"
        },
        "quantity": {
          "type": "number"
        }
      },
      "required": [
        "productId",
        "name",
        "price",
        "imageUrl",
        "quantity"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer's order.",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string" },
        "items": {
          "type": "array",
          "items": { "$ref": "#/backend/entities/OrderItem" }
        },
        "total": { "type": "number" },
        "status": {
          "type": "string",
          "enum": ["Placed", "Shipped", "Delivered", "Cancelled"]
        },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "userId", "items", "total", "status", "createdAt"]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents a single item within an order.",
      "properties": {
        "productId": { "type": "string" },
        "name": { "type": "string" },
        "price": { "type": "number" },
        "imageUrl": { "type": "string" },
        "quantity": { "type": "number" }
      },
      "required": ["productId", "name", "price", "imageUrl", "quantity"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information, including display name, email, avatar URL, and online status. The `userId` is the same as the Firebase Auth UID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/artisanProfiles/{artisanId}",
        "definition": {
          "entityName": "ArtisanProfile",
          "schema": {
            "$ref": "#/backend/entities/ArtisanProfile"
          },
          "description": "Stores artisan profile information. The 'artisanId' is the document ID.",
          "params": [
            {
              "name": "artisanId",
              "description": "The unique identifier of the artisan profile."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information.  The 'productId' is the document ID.  Includes denormalized data if required for authorization independence (e.g., if access control depends on the artisan, artisan details are duplicated here).",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier of the product."
            }
          ]
        }
      },
      {
        "path": "/tags/{tagId}",
        "definition": {
          "entityName": "Tag",
          "schema": {
            "$ref": "#/backend/entities/Tag"
          },
          "description": "Stores tag information. The 'tagId' is the document ID.",
          "params": [
            {
              "name": "tagId",
              "description": "The unique identifier of the tag."
            }
          ]
        }
      },
      {
        "path": "/storyCards/{storyCardId}",
        "definition": {
          "entityName": "StoryCard",
          "schema": {
            "$ref": "#/backend/entities/StoryCard"
          },
          "description": "Stores story card information. The 'storyCardId' is the document ID.",
          "params": [
            {
              "name": "storyCardId",
              "description": "The unique identifier of the story card."
            }
          ]
        }
      },
      {
        "path": "/contactMessages/{contactMessageId}",
        "definition": {
          "entityName": "ContactMessage",
          "schema": {
            "$ref": "#/backend/entities/ContactMessage"
          },
          "description": "Stores contact messages submitted by users.  The 'contactMessageId' is the document ID.",
          "params": [
            {
              "name": "contactMessageId",
              "description": "The unique identifier of the contact message."
            }
          ]
        }
      },
      {
        "path": "/customerReviews/{customerReviewId}",
        "definition": {
          "entityName": "CustomerReview",
          "schema": {
            "$ref": "#/backend/entities/CustomerReview"
          },
          "description": "Stores customer reviews for products and artisans. The 'customerReviewId' is the document ID.",
          "params": [
            {
              "name": "customerReviewId",
              "description": "The unique identifier of the customer review."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cart/{cartItemId}",
        "definition": {
          "entityName": "CartItem",
          "schema": {
            "$ref": "#/backend/entities/CartItem"
          },
          "description": "Stores items in a user's shopping cart. The 'userId' corresponds to the authenticated user's ID, and 'cartItemId' is the product ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "cartItemId",
              "description": "The unique identifier of the cart item (usually the product ID)."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores a user's orders. The 'userId' corresponds to the authenticated user's ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "orderId",
              "description": "The unique identifier of the order."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore data structure is designed to support the ArtEcho application, focusing on artisan profiles, products, and customer engagement features like reviews and contact messages. It prioritizes authorization independence through structural segregation and denormalization where necessary. The structure includes collections for artisans, products, tags, story cards, contact messages, and customer reviews. The design ensures secure data access and efficient querying while adhering to the principles of Authorization Independence (CRITICAL), Clarity of Intent (Debuggability), DBAC (No Custom Claims), QAPs (Rules are not Filters), and Invariants.\n\nSpecifically, the `contactMessages` and `customerReviews` collections are designed to support the newly requested features, \"About Us\" and \"Contact Us\" sections. The `contactMessages` collection directly stores contact form submissions. The `customerReviews` are stored to show customer feedback and maintain QAPs, these reviews can be listed and filtered as needed.\n\nAuthorization Independence:\n\nThe structure avoids hierarchical authorization dependencies (`get()`). For instance, access to a product does not depend on fetching data from the artisan's profile. While a `artisanId` field exists in the `products` collection, this is for data relationship purposes and not authorization. The QAPs are supported by the structural segregation - each collection has clear security requirements.\n\n"
  },
  "storage": {
    "rules": "rules_version = '2';\nservice firebase.storage {\n  match /b/{bucket}/o {\n    match /users/{userId}/avatar {\n      // Allow reads by anyone, including unauthenticated users\n      allow read;\n\n      // Allow authenticated users to write only to their own avatar path\n      allow write: if request.auth != null && request.auth.uid == userId;\n    }\n  }\n}\n"
  }
}

    